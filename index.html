<html>
<head>
	<link rel="stylesheet" href="bower_components/flipclock/compiled/flipclock.css">

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.js"></script>

	<script src="bower_components/flipclock/compiled/flipclock.js"></script>
	<style type="text/css">
	.body {background-color: #232323;}
	.clock {  width: 300px; margin: 200px auto;}
	label { color:rgb(100,100,100);}
	.hidden { display:none;}
	</style>
</head>
<body class="body">
	<div class="duration-field-wrapper">
		<label for="countdown_minutes">Countdown minutes</label>
		<input type="text" id="countdown_minutes" value="5" />
	</div>
	<div class="clock-wrapper">
		<div class="clock"></div>
		<div class="message"></div>
		<button class="start">Start Clock</button>
		<button class="stop hidden">Stop Clock</button>
	</div>
	<div class="share hidden">
		<input id="share_success_string" type="hidden" />
		<a id="twitter_link" href="http://twitter.com/">twitter</a>
	</div>
	<audio id="audio-bell" src="assets/124742__tec-studios__mono-bell-11-d-18sec.wav" preload="auto"></audio>
	<script type="text/javascript">
	var clock;
	var reveal_duration = 2000;
	var hide_duration = 2000;
	var successBGColor = "#0B6138";
	var countingColor = "#232323";
	var reachedGoalTime = false;

	var clickedStartButton = function(e) {
		reachedGoalTime = false;
		changePageColor(countingColor);
		clock.setTime($('#countdown_minutes').val() * 60);
		clock.setCountdown(true);
		clock.start();
		hideStuffs();
	}

	var clickedStopButton = function(e) {
		clock.stop();
		setSuccessString();
		revealStuffs();
	}

	var hideStuffs = function() {
		$('.start').hide(hide_duration);
		$('.duration-field-wrapper').hide(hide_duration);
		$('.share').hide(reveal_duration);
	}

	var revealStopButton = function() {
		$('.stop').show(reveal_duration);
	}

	var countDownFinished = function() {
		document.getElementById("audio-bell").play();
		revealStopButton();
		changePageColor(successBGColor);
	}

	var revealStuffs = function() {
		$('.stop').hide(reveal_duration);
		$('.share').show(reveal_duration);
		$('.start').show(hide_duration);
		$('.duration-field-wrapper').show(hide_duration);

	}

	var setSuccessString = function() {
		var intialMinutes = $('#countdown_minutes').val();
		var extraSeconds = clock.getTime().time;
		var extraMinutes = Math.floor(extraSeconds / 60);
		var successString;

		if(extraMinutes) {
			successString = "I meditated for " + intialMinutes + " minutes and " + extraMinutes + " bonus minutes!";
		} else {
			successString = "I meditated for " + intialMinutes + " minutes!";
		}
		// putting string here just for convenience
		// we could unhide this field or send its value to anything we like
		$("#share_success_string").val(successString);
		$("#twitter_link").attr("href","http://twitter.com/share/?text=" + successString);
	}

	var changePageColor = function(newColor) {
		$('.body').css({backgroundColor:newColor},1000);
	}

	$(document).ready(function() {
		clock = $('.clock').FlipClock({
			clockFace: 'MinuteCounter',
			countdown: true,
			autoStart: false,
			callbacks: {
				interval: function() {
					if(clock.getTime().time == 0 && !reachedGoalTime) {
						reachedGoalTime = true;
						clock.setCountdown(false);
						clock.start();
						countDownFinished();
					}
				}
			}
		});
		clock.setTime($('#countdown_minutes').val() * 60);

		$('.start').click(clickedStartButton);

		$('.stop').click(clickedStopButton)
	});
	</script>
</body>
</html>